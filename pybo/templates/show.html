<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>전시대 날짜별 신청</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-datepicker.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='bootstrap-datepicker.js') }}"></script>
   <script>
            <!--today:-월-일-요일-->
           function formatDate(date) {
                const monthNames = ["1월", "2월", "3월", "4월", "5월", "6월", "7월", "8월", "9월", "10월", "11월", "12월"];
                const dayNames = ["일요일", "월요일", "화요일", "수요일", "목요일", "금요일", "토요일"];
                const day = date.getDate();
                const monthIndex = date.getMonth();
                const year = date.getFullYear();
                const dayOfWeekIndex = date.getDay();

                return `today: ${monthNames[monthIndex]}${day}일 ${dayNames[dayOfWeekIndex]}`;
           }
       <!--    날짜를 클릭하면 업데이트보드 함수가 실행되고 업데이트보드함수에서는 겟데이오브윅함수를 실행하여 클릭한날짜의 요일을 불러온다 -->
           function getDayOfWeek(date) {
                const dayNames = ["일", "월", "화", "수", "목", "금", "토"];
                const dayOfWeekIndex = date.getDay();
                return dayNames[dayOfWeekIndex];
            }
          <!--  게시판생성-->
            function createBoard(dayOfWeek) {
                const board = `
                    <div class="${dayOfWeek}-board">
                        <h3>${dayOfWeek}요일</h3>
                        <div class="row">
                            ${createSlots(dayOfWeek)}
                        </div>
                    </div>
                `;

                return board;
            }

            function createSlots(dayOfWeek) {
                const slotNames = {
                    "화": ["10~12시", "12~2시", "2~4시", "7~9시"],
                    "목": ["12~2시", "2~4시", "7~9시"],
                    "토": ["10~12시(웨돔)","10~12시(마두)","12~2시(마두)", "2~4시(마두)"],
                    "일": ["1:30~3:30"]
                };

                let slots = '';
                for (let i = 0; i < slotNames[dayOfWeek].length; i++) {
                    slots += createSlot(slotNames[dayOfWeek][i],dayOfWeek);
                }

                return slots;
            }
            function createSlot(slotName, dayOfWeek) {
                const slotId = dayOfWeek.slice(0, 1).toLowerCase() + slotName.replace('~', '').replace('시', '').replace(/ /g, '').replace('(','').replace(')','').replace('웨돔','').replace('마두',''); // 예: tue1012
                const slot = `
                    <div class="board">
                        <div class="slot" data-slot="${slotId}">
                            <div class="slot-title">${slotName}</div>
                            <div class="applicants">ㅎㅎㅎㅎㅎ</div>
                            <div class="slot-button"><button type="button" class="btn btn-primary">신청</button></div>
                        </div>
                    </div>
                `;

                return slot;
            }

            function updateBoard(date) {
                const selectedDate = new Date(date);
                const dayOfWeek = getDayOfWeek(selectedDate);

                if (dayOfWeek === "화" || dayOfWeek === "목" || dayOfWeek === "토" || dayOfWeek === "일") {
                    const board = createBoard(dayOfWeek);
                    $('#board-container').html(board);
                } else {
                    $('#board-container').html(`<p>${dayOfWeek}요일</p><p>전시대 계획이 없습니다.</p>`);
                }
            }



            $(document).ready(function () {
                const today = new Date();
                const todayText = formatDate(today);
                $('#date-title').text(todayText);

                $('#datepicker').datepicker({
                    startDate: 'd',
                    endDate: '+7d',
                    format: 'yyyy-mm-dd',
                    autoclose: false,
                    inline: true
                }).on('changeDate', function (e) {
                    const selectedDate = e.format('yyyy-mm-dd');
                    updateBoard(selectedDate);
                });

                $('body').on('click', '.btn-primary', function () {
                    const slot = $(this).closest('.slot').find('.slot-title').text(); // 슬롯 이름 가져오기

                    $.ajax({
                        url: '/apply',
                        method: 'POST',
                        data: {
                            username: '{{ username }}',
                            slot: slot
                        },
                        success: function (response) {
                            alert(response.message);
                        },
                        error: function (response) {
                            alert(response.responseJSON.error);
                        }
                    });
                });
        });

    </script>
</head>
<body>
    <div class="container">
        <div >
            <h2 class ="container s2" id="date-title"></h2>
            <h3 class="container s3"> 달력에서 신청할 날짜를 선택하세요 </h3>
            <div id="datepicker" class="form-control"></div>
            <div id="board-container">
                <!-- 여기에 게시판이 표시됩니다. -->
            </div>
        </div>
    </div>

</body>
</html>